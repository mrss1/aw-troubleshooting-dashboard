<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Troubleshooting Checklist</title>
    <style>
      :root {
        --theme-color: #4a90e2;
        --theme-hover-color: #4a91e26b;
      }
      body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f9;
        color: #333;
        margin: 0;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      h1 {
        text-align: center;
        color: var(--theme-color);
      }

      .main-wrapper {
        display: flex;
        justify-content: center;
        align-items: flex-start;
        width: 100%;
        max-width: 1200px;
        margin-top: 20px;
        gap: 20px;
      }

      /* Main content container */
      .container {
        background-color: #ffffff;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        padding: 20px;
        width: 100%;
        max-width: 600px;
        box-sizing: border-box;
      }

      /* Search container styling */
      .search-container {
        background-color: #ffffff;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        padding: 20px;
        width: 100%;
        max-width: 300px;
        box-sizing: border-box;
      }

      .tabs {
        display: flex;
        margin-bottom: 20px;
        border-bottom: 2px solid #ddd;
      }

      .tab {
        padding: 10px 20px;
        cursor: pointer;
        background-color: #f4f4f9;
        border: 1px solid #ddd;
        border-radius: 5px 5px 0 0;
        margin-right: 5px;
        transition: 0.25s linear;
      }

      .tab:hover {
        background-color: var(--theme-hover-color);
      }

      .tab.active {
        color: #ffffff;
        background-color: var(--theme-color);
        border-bottom: 2px solid white;
        border: 1px solid var(--theme-color);
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .form-group {
        margin-bottom: 15px;
      }

      label {
        font-weight: bold;
        color: var(--theme-color);
      }

      select,
      textarea,
      input {
        width: calc(100% - 2px);
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        margin-top: 5px;
        font-size: 16px;
      }

      select {
        cursor: pointer;
      }

      textarea {
        resize: none;
        background-color: #f9f9f9;
      }

      .text-area-container {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      textarea[readonly] {
        background-color: #f0f8ff;
        font-size: 15px;
        font-family: Arial, sans-serif;
        color: #333;
        padding: 10px;
        box-sizing: border-box;
      }

      button {
        padding: 15px 20px;
        background-color: #f4f4f9;
        border: 1px solid #ddd;
        border-radius: 5px;
        transition: 0.25s linear;
      }

      button:hover {
        color: #ffffff;
        background-color: var(--theme-color);
        box-shadow: 1px 0 1 0 rgba(0, 0, 0, 0.171);
      }

      /* Responsive adjustments */
      @media (max-width: 768px) {
        .container {
          padding: 15px;
        }

        h1 {
          font-size: 20px;
        }

        select,
        textarea {
          font-size: 14px;
        }
      }

      @media (max-width: 960px) {
        .main-wrapper {
          flex-direction: column;
          align-items: center;
        }
        .search-container {
          max-width: 600px;
          width: 100%;
        }
      }

      @media (max-width: 480px) {
        .container {
          padding: 10px;
          width: 100%;
        }

        h1 {
          font-size: 18px;
        }

        button {
          padding: 10px 15px;
        }
      }

      .search-results ul {
        list-style-type: none;
        padding: 0;
      }

      .search-results li {
        margin-bottom: 10px;
      }

      .search-results a {
        color: var(--theme-color);
        text-decoration: underline;
        cursor: pointer;
      }

      .search-results a:hover {
        text-decoration: none;
      }
    </style>
  </head>
  <body>
    <h1>AirWatch Troubleshooting Dashboard</h1>
    <div class="main-wrapper">
      <div class="container">
        <div class="form-group">
          <label for="deviceType">Device Type</label>
          <select id="deviceType" onchange="updateDeviceType()">
            <option value="">Select Device Type</option>
            <option value="iOS">iPhone/iPad</option>
            <option value="Mac">Mac</option>
            <option value="Android">Android</option>
          </select>
        </div>

        <!-- New/Existing Device Dropdown -->
        <div
          class="form-group"
          id="deviceStatusContainer"
          style="display: none"
        >
          <label for="deviceStatus">Device Status</label>
          <select id="deviceStatus" onchange="updateDeviceStatus()">
            <option value="">Select Device Status</option>
            <option value="New">New Device</option>
            <option value="Existing">Existing Device</option>
          </select>
        </div>

        <div class="tab-content" id="deviceChecklistTab" style="display: none">
          <div class="tabs">
            <div class="tab active" onclick="showTab('checklistTab')">
              Checklist
            </div>
            <div class="tab" onclick="showTab('howToTab')">How To's</div>
          </div>

          <div class="tab-content active" id="checklistTab">
            <div class="form-group">
              <label for="failurePoint">Failure Point</label>
              <select id="failurePoint" onchange="updateSymptoms()">
                <option value="">Select Failure Point</option>
              </select>
            </div>

            <div class="form-group">
              <label for="symptom">Symptom</label>
              <select id="symptom" onchange="populateDetails()">
                <option value="">Select Symptom</option>
              </select>
            </div>

            <div class="text-area-container">
              <div class="form-group">
                <label for="correctiveSteps">Corrective Steps</label>
                <textarea id="correctiveSteps" rows="4" readonly></textarea>
              </div>

              <div class="form-group">
                <label for="cause">Cause</label>
                <textarea id="cause" rows="2" readonly></textarea>
              </div>

              <div class="form-group">
                <label for="notes">Notes</label>
                <textarea id="notes" rows="2" readonly></textarea>
              </div>
            </div>
          </div>

          <div class="tab-content" id="howToTab">
            <h2>How To's</h2>

            <div class="form-group">
              <label for="howToCategory">Category</label>
              <select id="howToCategory" onchange="updateHowToSteps()">
                <option value="">Select Category</option>
              </select>
            </div>

            <div class="form-group">
              <label for="howToSteps">Steps</label>
              <textarea id="howToSteps" rows="6" readonly></textarea>
            </div>

            <div class="form-group">
              <label for="howToNotes">Notes</label>
              <textarea id="howToNotes" rows="3" readonly></textarea>
            </div>
          </div>
        </div>
      </div>

      <!-- Separate Search Container -->
      <div class="search-container">
        <div class="form-group">
          <label for="searchBar">Search</label>
          <input
            type="text"
            id="searchBar"
            placeholder="Search for failure points, symptoms, or how-to's"
            oninput="filterSearch()"
          />
        </div>
        <div class="search-results" id="searchResults"></div>
      </div>
    </div>

    <script>
      // Data structure holding troubleshooting information
      let troubleshootingData = {
        iOS: {
          New: {
            "Initial Setup": {
              "Device not enrolling": {
                Cause: "The device is not properly set up in AirWatch.",
                CorrectiveSteps:
                  "Ensure device is factory reset and enroll using corporate MDM instructions.",
                Notes: "If enrollment fails repeatedly, check with MDM admin.",
              },
            },
          },
          Existing: {
            "Re-enter Password": {
              "Prompt to enter username is not given": {
                Cause: "Wrong username was entered",
                CorrectiveSteps:
                  "Clear Safari 'History and Website Data' > Settings > Safari",
                Notes:
                  "If the wrong username and 'Remember setting' is checked, prompt won't appear again.",
              },
              "Error 'Enter message' after entering username": {
                Cause: "Request Desktop Website is turned On",
                CorrectiveSteps:
                  "Disable 'All Websites' > Settings > Safari > Request Desktop Website",
                Notes: "Some iOS versions default this on. Turn it off.",
              },
              "Microsoft Authenticator installed": {
                Cause: "Microsoft Authenticator is installed",
                CorrectiveSteps:
                  "Uninstall unmanaged Authenticator via AirWatch Console, re-install managed version.",
                Notes: "App can be re-installed after password update.",
              },
            },
            "Email not Syncing": {
              "No new emails, Unable to connect to WiFi, etc.": {
                Cause:
                  "Device record in AW Console needs removal for another user",
                CorrectiveSteps:
                  "Reset Network Settings > General > Transfer or Reset iPhone > Reset > Reset Network Settings",
                Notes: "Issue often caused by device switch.",
              },
            },
          },
        },
        Mac: {
          New: {
            "Initial Setup": {
              "MDM Profile not installing": {
                Cause: "Network issues or blocked MDM profile.",
                CorrectiveSteps:
                  "Check WiFi & ensure device on company network. Retry MDM installation.",
                Notes: "Contact IT if persists.",
              },
            },
          },
          Existing: {
            "WiFi Issues": {
              "Cannot connect to WiFi": {
                Cause: "Incorrect network settings",
                CorrectiveSteps:
                  "System Preferences > Network > WiFi > Advanced, remove problematic network, reconnect.",
                Notes: "Verify WiFi password.",
              },
            },
          },
        },
        Android: {
          New: {
            "Initial Setup": {
              "Play Store missing work apps": {
                Cause: "Work profile not configured properly.",
                CorrectiveSteps:
                  "Check that a managed work profile is created. Re-sync device.",
                Notes: "Contact mobile admin if apps still missing.",
              },
            },
          },
          Existing: {
            "App Crashing": {
              "App crashes on launch": {
                Cause: "Corrupted app data",
                CorrectiveSteps:
                  "Settings > Apps > [App Name] > Storage > Clear Data/Cache. Restart app.",
                Notes: "Ensure app is updated.",
              },
            },
          },
        },
      };

      let howToData = {
        iOS: {
          "Reset Device": {
            Steps:
              "1. Settings > General\n2. Reset\n3. Erase All Content and Settings\n4. Confirm",
            Notes: "This erases all data. Back up first.",
          },
          "Setup Email Account": {
            Steps:
              "1. Open Mail app\n2. Enter email and password\n3. Follow prompts",
            Notes: "Use corporate server settings.",
          },
        },
        Mac: {
          "Set Up WiFi": {
            Steps: "1. Click WiFi icon\n2. Select network\n3. Enter password",
            Notes: "Ensure network is secure.",
          },
        },
        Android: {
          "Clear Cache": {
            Steps:
              "1. Settings > Apps\n2. Select app\n3. Storage > Clear Cache",
            Notes: "Clearing cache can fix many issues.",
          },
        },
      };

      function updateDeviceType() {
        const deviceType = document.getElementById("deviceType").value;
        const deviceStatusContainer = document.getElementById(
          "deviceStatusContainer"
        );
        const deviceStatus = document.getElementById("deviceStatus");
        const deviceChecklistTab =
          document.getElementById("deviceChecklistTab");

        // Reset everything upon device type change
        deviceStatus.selectedIndex = 0;
        deviceChecklistTab.style.display = "none";
        clearAllDropdownsAndFields();

        if (!deviceType) {
          deviceStatusContainer.style.display = "none";
          resetThemeColors();
          return;
        }

        // Show device status dropdown
        deviceStatusContainer.style.display = "block";
        resetThemeColorsByDevice(deviceType);
      }

      function updateDeviceStatus() {
        const deviceType = document.getElementById("deviceType").value;
        const deviceStatus = document.getElementById("deviceStatus").value;
        const deviceChecklistTab =
          document.getElementById("deviceChecklistTab");

        // Clear all fields when status changes
        clearAllDropdownsAndFields();

        if (!deviceType || !deviceStatus) {
          deviceChecklistTab.style.display = "none";
          return;
        }

        // Both deviceType and deviceStatus are selected
        deviceChecklistTab.style.display = "block";
        showTab("checklistTab");
        populateFailurePoints(deviceType, deviceStatus);
        populateHowToCategories(deviceType);
      }

      function resetThemeColors() {
        document.documentElement.style.setProperty("--theme-color", "#4a90e2");
        document.documentElement.style.setProperty(
          "--theme-hover-color",
          "#4a91e26b"
        );
      }

      function resetThemeColorsByDevice(deviceType) {
        if (deviceType === "Mac") {
          document.documentElement.style.setProperty(
            "--theme-color",
            "#800080"
          );
          document.documentElement.style.setProperty(
            "--theme-hover-color",
            "#8000806b"
          );
        } else if (deviceType === "Android") {
          document.documentElement.style.setProperty(
            "--theme-color",
            "#008000"
          );
          document.documentElement.style.setProperty(
            "--theme-hover-color",
            "#0080006b"
          );
        } else {
          // iOS default
          document.documentElement.style.setProperty(
            "--theme-color",
            "#4a90e2"
          );
          document.documentElement.style.setProperty(
            "--theme-hover-color",
            "#4a91e26b"
          );
        }
      }

      function clearAllDropdownsAndFields() {
        document.getElementById("failurePoint").innerHTML =
          '<option value="">Select Failure Point</option>';
        document.getElementById("symptom").innerHTML =
          '<option value="">Select Symptom</option>';
        document.getElementById("howToCategory").innerHTML =
          '<option value="">Select Category</option>';
        clearFields();
        document.getElementById("howToSteps").value = "";
        document.getElementById("howToNotes").value = "";
      }

      function showTab(tabId) {
        const tabs = document.querySelectorAll(".tab");
        const contents = document.querySelectorAll(".tab-content");

        tabs.forEach((tab) => tab.classList.remove("active"));
        contents.forEach((content) => content.classList.remove("active"));

        document
          .querySelector(`[onclick="showTab('${tabId}')"]`)
          .classList.add("active");
        document.getElementById(tabId).classList.add("active");
      }

      function populateHowToCategories(deviceType) {
        const howToCategorySelect = document.getElementById("howToCategory");
        howToCategorySelect.innerHTML =
          '<option value="">Select Category</option>';

        for (const category in howToData[deviceType]) {
          const option = document.createElement("option");
          option.value = category;
          option.textContent = category;
          howToCategorySelect.appendChild(option);
        }
      }

      function updateHowToSteps() {
        const deviceType = document.getElementById("deviceType").value;
        const howToCategory = document.getElementById("howToCategory").value;
        const howToSteps = document.getElementById("howToSteps");
        const howToNotes = document.getElementById("howToNotes");

        howToSteps.value = "";
        howToNotes.value = "";

        if (
          deviceType &&
          howToCategory &&
          howToData[deviceType][howToCategory]
        ) {
          howToSteps.value = howToData[deviceType][howToCategory].Steps;
          howToNotes.value = howToData[deviceType][howToCategory].Notes;
        }
      }

      function populateFailurePoints(deviceType, deviceStatus) {
        const failurePointSelect = document.getElementById("failurePoint");
        failurePointSelect.innerHTML =
          '<option value="">Select Failure Point</option>';

        if (
          troubleshootingData[deviceType] &&
          troubleshootingData[deviceType][deviceStatus]
        ) {
          for (const failurePoint in troubleshootingData[deviceType][
            deviceStatus
          ]) {
            const option = document.createElement("option");
            option.value = failurePoint;
            option.textContent = failurePoint;
            failurePointSelect.appendChild(option);
          }
        }
      }

      function updateSymptoms() {
        const deviceType = document.getElementById("deviceType").value;
        const deviceStatus = document.getElementById("deviceStatus").value;
        const failurePoint = document.getElementById("failurePoint").value;
        const symptomSelect = document.getElementById("symptom");

        symptomSelect.innerHTML = '<option value="">Select Symptom</option>';
        clearFields();

        if (
          deviceType &&
          deviceStatus &&
          failurePoint &&
          troubleshootingData[deviceType][deviceStatus][failurePoint]
        ) {
          for (const symptom in troubleshootingData[deviceType][deviceStatus][
            failurePoint
          ]) {
            const option = document.createElement("option");
            option.value = symptom;
            option.textContent = symptom;
            symptomSelect.appendChild(option);
          }
        }
      }

      function populateDetails() {
        const deviceType = document.getElementById("deviceType").value;
        const deviceStatus = document.getElementById("deviceStatus").value;
        const failurePoint = document.getElementById("failurePoint").value;
        const symptom = document.getElementById("symptom").value;

        const correctiveSteps = document.getElementById("correctiveSteps");
        const cause = document.getElementById("cause");
        const notes = document.getElementById("notes");

        if (
          !deviceType ||
          !deviceStatus ||
          !failurePoint ||
          !symptom ||
          !troubleshootingData[deviceType][deviceStatus][failurePoint] ||
          !troubleshootingData[deviceType][deviceStatus][failurePoint][symptom]
        ) {
          clearFields();
          return;
        }

        const details =
          troubleshootingData[deviceType][deviceStatus][failurePoint][symptom];
        correctiveSteps.value = details.CorrectiveSteps;
        cause.value = details.Cause;
        notes.value = details.Notes;
      }

      function clearFields() {
        document.getElementById("correctiveSteps").value = "";
        document.getElementById("cause").value = "";
        document.getElementById("notes").value = "";
      }

      // Filter search results and make them clickable
      function filterSearch() {
        const query = document.getElementById("searchBar").value.toLowerCase();
        const resultsContainer = document.getElementById("searchResults");
        resultsContainer.innerHTML = "";

        if (!query) {
          return;
        }

        let results = [];

        // Search in troubleshooting data
        for (const device in troubleshootingData) {
          for (const status in troubleshootingData[device]) {
            for (const failurePoint in troubleshootingData[device][status]) {
              // Match failure points
              if (failurePoint.toLowerCase().includes(query)) {
                results.push({
                  deviceType: device,
                  deviceStatus: status,
                  failurePoint: failurePoint,
                  symptom: null,
                  howToCategory: null,
                  label: `Device: ${device}, Status: ${status}, Failure Point: ${failurePoint}`,
                });
              }
              for (const symptom in troubleshootingData[device][status][
                failurePoint
              ]) {
                // Match symptoms
                if (symptom.toLowerCase().includes(query)) {
                  results.push({
                    deviceType: device,
                    deviceStatus: status,
                    failurePoint: failurePoint,
                    symptom: symptom,
                    howToCategory: null,
                    label: `Device: ${device}, Status: ${status}, Symptom: ${symptom}`,
                  });
                }
              }
            }
          }
        }

        // Search in howTo data
        for (const device in howToData) {
          for (const category in howToData[device]) {
            let steps = howToData[device][category].Steps.toLowerCase();
            let notes = howToData[device][category].Notes.toLowerCase();

            let matched = false;

            if (category.toLowerCase().includes(query)) {
              matched = true;
            } else if (steps.includes(query)) {
              matched = true;
            } else if (notes.includes(query)) {
              matched = true;
            }

            if (matched) {
              results.push({
                deviceType: device,
                deviceStatus: null,
                failurePoint: null,
                symptom: null,
                howToCategory: category,
                label: `Device: ${device}, How To: ${category}`,
              });
            }
          }
        }

        if (results.length === 0) {
          resultsContainer.innerHTML = "No results found.";
        } else {
          let html = "<ul>";
          results.forEach((r) => {
            html += `<li><a href="#" onclick="selectSearchResult('${
              r.deviceType
            }','${r.deviceStatus || ""}','${r.failurePoint || ""}','${
              r.symptom || ""
            }','${r.howToCategory || ""}')">${r.label}</a></li>`;
          });
          html += "</ul>";
          resultsContainer.innerHTML = html;
        }
      }

      // When a search result is clicked, select the result in the dashboard
      function selectSearchResult(
        deviceType,
        deviceStatus,
        failurePoint,
        symptom,
        howToCategory
      ) {
        // First, set the deviceType if available
        document.getElementById("deviceType").value = deviceType || "";
        updateDeviceType();

        if (deviceStatus) {
          document.getElementById("deviceStatus").value = deviceStatus;
          updateDeviceStatus();
        }

        // If howToCategory is provided, we show the howToTab
        if (howToCategory && howToCategory !== "null") {
          // Switch to How To tab
          showTab("howToTab");
          document.getElementById("howToCategory").value = howToCategory;
          updateHowToSteps();
        } else {
          // Otherwise, we deal with the failurePoint and symptom
          if (failurePoint && failurePoint !== "null") {
            document.getElementById("failurePoint").value = failurePoint;
            updateSymptoms();
          }

          if (symptom && symptom !== "null") {
            document.getElementById("symptom").value = symptom;
            populateDetails();
            // Switch to checklist tab
            showTab("checklistTab");
          }
        }

        // Scroll to top of the page or dashboard
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      window.onload = function () {
        document.getElementById("deviceType").selectedIndex = 0;
        clearAllDropdownsAndFields();
        document.getElementById("deviceChecklistTab").style.display = "none";
      };
    </script>
  </body>
</html>
